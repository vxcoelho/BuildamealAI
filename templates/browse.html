{% extends "base.html" %}

{% block title %}Browse Recipes - Build A Meal{% endblock %}

{% block content %}
<style>
    .browse-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .browse-title {
        font-family: 'Playfair Display', serif;
        font-size: 3.5rem;
        background: linear-gradient(135deg, #FF6B35 0%, #FFD700 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 15px;
        letter-spacing: 2px;
        font-weight: 800;
    }

    .browse-subtitle {
        color: #999;
        font-size: 1.2rem;
    }

    .search-box {
        max-width: 800px;
        margin: 0 auto 40px;
    }

    .search-input {
        width: 100%;
        padding: 20px 30px;
        font-size: 1.1rem;
        border: 3px solid rgba(255, 107, 53, 0.3);
        border-radius: 60px;
        background: #1a1a1a;
        color: #ffffff;
        transition: all 0.3s;
    }

    .search-input:focus {
        outline: none;
        border-color: #FF6B35;
        box-shadow: 0 0 30px rgba(255, 107, 53, 0.4);
    }

    .search-input::placeholder {
        color: #666;
    }

    .filters {
        margin-bottom: 40px;
        text-align: center;
    }

    .filter-group {
        margin-bottom: 25px;
    }

    .filter-label {
        color: #FF6B35;
        font-weight: 600;
        margin-bottom: 15px;
        display: block;
        font-size: 1.1rem;
    }

    .filter-btn {
        background: #2d2d2d;
        color: #cccccc;
        border: 2px solid rgba(255, 107, 53, 0.3);
        padding: 12px 28px;
        border-radius: 30px;
        margin: 5px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 1rem;
        font-weight: 600;
    }

    .filter-btn:hover {
        border-color: #FF6B35;
        background: rgba(255, 107, 53, 0.1);
        transform: translateY(-2px);
    }

    .filter-btn.active {
        background: linear-gradient(135deg, #FF6B35 0%, #FF8C42 100%);
        color: #000000;
        border-color: #FF6B35;
    }

    .recipes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 30px;
        margin-top: 40px;
    }

    .recipe-card {
        background: #2d2d2d;
        border-radius: 15px;
        padding: 30px;
        border: 2px solid rgba(255, 107, 53, 0.2);
        transition: all 0.3s;
    }

    .recipe-card:hover {
        border-color: #FF6B35;
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
    }

    .recipe-title {
        font-family: 'Playfair Display', serif;
        color: #FF6B35;
        font-size: 1.8rem;
        margin-bottom: 15px;
        font-weight: 700;
    }

    .recipe-time {
        color: #999;
        font-size: 1rem;
        margin-bottom: 15px;
    }

    .recipe-ingredients {
        color: #cccccc;
        line-height: 1.6;
        margin-bottom: 15px;
        font-size: 0.95rem;
    }

    .recipe-instructions {
        color: #999;
        line-height: 1.7;
        font-size: 0.95rem;
    }

    .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #999;
        font-size: 1.3rem;
    }

    .clear-filters {
        background: transparent;
        color: #FF6B35;
        border: 2px solid #FF6B35;
        padding: 10px 25px;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 1rem;
        font-weight: 600;
        margin-top: 15px;
    }

    .clear-filters:hover {
        background: #FF6B35;
        color: #000000;
    }
</style>

<div class="browse-header">
    <h2 class="browse-title">Recipe Collection</h2>
    <p class="browse-subtitle">{{ recipes|length }} delicious recipes ready to inspire</p>
</div>

<div class="search-box">
    <input type="text" id="searchInput" class="search-input" placeholder="üîç Search by name or ingredients...">
</div>

<div class="filters">
    <div class="filter-group">
        <span class="filter-label">Cuisine</span>
        <button class="filter-btn cuisine-filter active" data-cuisine="all">All</button>
        <button class="filter-btn cuisine-filter" data-cuisine="italian">Italian</button>
        <button class="filter-btn cuisine-filter" data-cuisine="mexican">Mexican</button>
        <button class="filter-btn cuisine-filter" data-cuisine="american">American</button>
        <button class="filter-btn cuisine-filter" data-cuisine="asian">Asian</button>
    </div>
    
    <div class="filter-group">
        <span class="filter-label">Cooking Time</span>
        <button class="filter-btn time-filter active" data-time="all">All</button>
        <button class="filter-btn time-filter" data-time="quick">Quick (&lt;20 min)</button>
        <button class="filter-btn time-filter" data-time="medium">Medium (20-45 min)</button>
        <button class="filter-btn time-filter" data-time="long">Long (45+ min)</button>
    </div>
    
    <button class="clear-filters" onclick="clearAllFilters()">Clear All Filters</button>
</div>

<div class="recipes-grid" id="recipesGrid">
    {% for recipe in recipes %}
    <div class="recipe-card" 
         data-title="{{ recipe.title|lower }}" 
         data-ingredients="{{ recipe.ingredients|lower }}"
         data-time="{{ recipe.cooking_time }}"
         data-cuisine="{{ recipe.cuisine|lower }}">
        <div class="recipe-title">{{ recipe.title }}</div>
        <div class="recipe-time">‚è±Ô∏è {{ recipe.cooking_time }} minutes</div>
        <div class="recipe-ingredients"><strong>Ingredients:</strong> {{ recipe.ingredients }}</div>
        <div class="recipe-instructions"><strong>Instructions:</strong> {{ recipe.instructions[:150] }}{% if recipe.instructions|length > 150 %}...{% endif %}</div>
    </div>
    {% endfor %}
</div>

<div class="no-results" id="noResults" style="display: none;">
    No recipes found. Try different filters or search terms!
</div>

<script>
let activeTimeFilter = 'all';
let activeCuisineFilter = 'all';
let searchTerm = '';

// Search functionality
document.getElementById('searchInput').addEventListener('input', function(e) {
    searchTerm = e.target.value.toLowerCase();
    filterRecipes();
});

// Cuisine filter
document.querySelectorAll('.cuisine-filter').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.cuisine-filter').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        activeCuisineFilter = this.dataset.cuisine;
        filterRecipes();
    });
});

// Time filter
document.querySelectorAll('.time-filter').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.time-filter').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        activeTimeFilter = this.dataset.time;
        filterRecipes();
    });
});

function filterRecipes() {
    const cards = document.querySelectorAll('.recipe-card');
    let visibleCount = 0;
    
    cards.forEach(card => {
        const title = card.dataset.title;
        const ingredients = card.dataset.ingredients;
        const time = parseInt(card.dataset.time);
        const cuisine = card.dataset.cuisine;
        
        // Search filter
        const matchesSearch = searchTerm === '' || 
                            title.includes(searchTerm) || 
                            ingredients.includes(searchTerm);
        
        // Time filter
        let matchesTime = true;
        if (activeTimeFilter === 'quick') matchesTime = time < 20;
        else if (activeTimeFilter === 'medium') matchesTime = time >= 20 && time <= 45;
        else if (activeTimeFilter === 'long') matchesTime = time > 45;
        
        // Cuisine filter
        const matchesCuisine = activeCuisineFilter === 'all' || 
                              cuisine.includes(activeCuisineFilter);
        
        if (matchesSearch && matchesTime && matchesCuisine) {
            card.style.display = 'block';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
    
    // Show/hide no results message
    document.getElementById('noResults').style.display = visibleCount === 0 ? 'block' : 'none';
    document.getElementById('recipesGrid').style.display = visibleCount === 0 ? 'none' : 'grid';
}

function clearAllFilters() {
    searchTerm = '';
    activeTimeFilter = 'all';
    activeCuisineFilter = 'all';
    document.getElementById('searchInput').value = '';
    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('[data-cuisine="all"], [data-time="all"]').forEach(btn => btn.classList.add('active'));
    filterRecipes();
}
</script>
{% endblock %}
